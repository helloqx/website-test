{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
    <div class='container'>
        <h1>Select Songs</h1>
        <form action="{{ url_for('display') }}", method="POST">
            {{ wtf.quick_form(form) }}
        </form>
        <hr>
        <table id="all_songs" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Song</th>
                    <th>Lyrics (First Slide)</th>
                    <th>Actions</th>
                    <th>Lyrics (Rest)</th>
                </tr>
            </thead>
            <tbody>
                {% for song in songs %}
                    {% include '_song.html' %}
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
<script>
    var chosenSongId = []
    var chosenSongTitles = []

        $('#all_songs').dataTable( {
        "columnDefs": [
            {
                "targets": [ 2 ],
                "orderable": false,
                "searchable": false
            },
            {
                "targets": [ 3 ],
                "visible": false
            }
        ]
    } );

    $(document).ready( function () {
        $('#all_songs').DataTable();
        $('#ids').val("");
        $('#selected').val("");
    } );
    
    // Add/Remove songs
    $('#all_songs').on('click', '.select', ( 
        function(e) {
            var id = $(this).attr('id')
            var index = chosenSongId.indexOf(id);
            if (index > -1) {
              chosenSongId.splice(index, 1);
              chosenSongTitles.splice(index, 1);
            } else {
                chosenSongId.push(id)
                chosenSongTitles.push($(this).attr('name'))
            }
            $('#ids').val(chosenSongId.join(', '));
            $('#selected').val(chosenSongTitles.join(', '));
            e.preventDefault();
        })
    );
    $('#all_songs').on('click', '.fas', ( 
        function(e) {
            $(this).toggleClass("fa-plus fa-minus");
            e.preventDefault();
        })
    );
</script>
{% endblock %}

{% block styles%}
{{ super() }}
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap4.min.css">
{% endblock %}

{% block help_modal %}
    Click <span class="fas fa-plus"></span> to add a song.
    <br>
    Click <span class="fas fa-minus"></span> to remove a song.
    <br>
    Click <span class="fab fa-youtube"></span> to listen to the song on Youtube.
    <hr>
    Click <input class="btn btn-default" type="submit" value="Display"> after choosing 1 or more songs to launch the slides.
    <br>
    If you are logged in, the slides will be saved and can be accessed from 'Saved Slides'.
{% endblock %}
